---
import type { GetStaticPaths } from 'astro'
import PagesLayout, {
  type Props as PagesLayoutProps
} from '~/layouts/pages.astro'
import { Image } from 'astro:assets'
import { getCollection, render } from 'astro:content'

export const getStaticPaths = (async () => {
  const projects = await getCollection('projects', (entry) => entry.data.page)
  return projects.map((project) => ({
    params: {
      id: project.id
    },
    props: {
      project
    }
  }))
}) satisfies GetStaticPaths

const { project } = Astro.props
const { Content } = await render(project)
const props = {
  title: project.data.title,
  description: project.data.description
} satisfies PagesLayoutProps
---

<PagesLayout {...props}>
  <article class='prose mx-auto max-w-none'>
    <Content />
  </article>

  <Fragment slot='header-2'>
    {
      project.data.image && (
        <Image
          class='mb-4 w-full sm:mb-0 sm:mr-8 sm:w-[288px]'
          src={project.data.image}
          widths={[576]}
          sizes='576px'
          loading='eager'
          alt=''
        />
      )
    }
  </Fragment>
</PagesLayout>
