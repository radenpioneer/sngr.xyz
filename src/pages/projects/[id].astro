---
import type { GetStaticPaths } from 'astro'
import PagesLayout, {
  type Props as PagesLayoutProps
} from '~/layouts/pages.astro'
import PageHeader from '~/components/projects/page.astro'
import { getCollection, render } from 'astro:content'
import { HomeButton, BackButton } from '~/components/common/button'

export const getStaticPaths = (async () => {
  const projects = await getCollection(
    'projects',
    (entry) => !entry.data.draft && entry.data.page
  )
  return projects.map((project) => ({
    params: {
      id: project.id
    },
    props: {
      project
    }
  }))
}) satisfies GetStaticPaths

const { project } = Astro.props
const { Content } = await render(project)
const props = {
  title: project.data.title,
  description: project.data.description
} satisfies PagesLayoutProps

// const image = project.data.image
//   ? await getImage({ src: project.data.image, widths: [380] })
//   : undefined
---

<PagesLayout {...props}>
  <article
    class='prose prose-zinc mx-auto mb-12 sm:prose-lg lg:prose-xl prose-img:my-2 sm:prose-img:my-4 sm:prose-img:px-8'
  >
    <Content />
  </article>

  <Fragment slot='header'>
    <PageHeader project={project} />
  </Fragment>

  <Fragment slot='nav'>
    <BackButton href='/projects' aria-label='All Projects' />
    <HomeButton href='/#projects' aria-label='Home' />
  </Fragment>
</PagesLayout>
