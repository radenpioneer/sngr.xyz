---
import type { GetStaticPaths } from 'astro'
import PagesLayout, {
  type Props as PagesLayoutProps
} from '~/layouts/pages.astro'
import { Image } from 'astro:assets'
import { getCollection, render } from 'astro:content'

export const getStaticPaths = (async () => {
  const projects = await getCollection('projects', (entry) => entry.data.page)
  return projects.map((project) => ({
    params: {
      id: project.id
    },
    props: {
      project
    }
  }))
}) satisfies GetStaticPaths

const { project } = Astro.props
const { Content } = await render(project)
const props = {
  title: project.data.title,
  description: project.data.description
} satisfies PagesLayoutProps
---

<PagesLayout {...props}>
  <article class='prose mx-auto max-w-none'>
    <Content />
  </article>

  <Fragment slot='header'>
    {
      project.data.logo && (
        <h1 class=''>
          <Image
            class='mx-auto w-[144px]'
            src={project.data.logo}
            widths={[288]}
            sizes='288px'
            loading='eager'
            alt={project.data.title}
          />
        </h1>
      )
    }
  </Fragment>
</PagesLayout>
